/*! autoResponsive - v1.1 - 2013-07-06 9:03:16 PM
* Copyright (c) 2013 xudafeng; Licensed  */
KISSY.add("gallery/autoResponsive/1.1/plugin/loader",function(e){"use strict";function n(n){var t=this;n={load:"function"==typeof n.load?n.load:function(){e.log("AutoResponsive.Loader::constructor: the load function in user's config is undefined!","warn")},diff:n.diff||0,mod:"manual"==n.mod?"manual":"auto",qpt:15},t.config=n}function t(n,t,i,r){var o,a={},s=[],u=i.config,c=u.qpt||15;return a.start=function(){s=s.concat(e.makeArray(n));var u=function(){for(var e=+new Date;s.length>0&&50>new Date-e;){var l=s.splice(0,c);t.call(i,l)}return s.length>0?(o=setTimeout(u,25),void 0):(r&&r.call(i,n),a.stop(),a=null,void 0)};u()},a.stop=function(){o&&(clearTimeout(o),s=[])},a}var i=e.DOM,r=e.all,o=window,a=r(o),s=50;return e.augment(n,e.EventTarget,{init:function(n){var t=this,i=t.config,r=i.mod;t.owner=n,t.__bindMethods(),"manual"===r||(t.__onScroll=e.buffer(t.__doScroll,s,t),t.__onScroll(),t.start())},__doScroll:function(){var n=this,t=n.owner,r=n.config;if(e.log("AutoResponsive.Loader::__doScroll..."),!n.__loading){if(t.isAdjusting())return n.__onScroll(),void 0;var o=e.get(t.get("container"));if(o.offsetWidth){var s=i.offset(o).top,u=r.diff,c=t.getMinColHeight(),l=a.scrollTop(),f=a.height();u+l+f>=s+c&&n.load()}}},load:function(){function n(e,n){i.__loading=0,i.__addItems(e,function(){n&&n.call(i),i.__doScroll()})}function t(){i.stop()}var i=this,r=i.config,o=r.load;e.log("AutoResponsive.Loader::loading..."),i.__loading=1,o&&o(n,t)},__addItems:function(e,n){var i=this;t(e,i.__appendItems,i,function(){n&&n.call(i),i.fire("autoresponsive.loader.complete",{items:e})}).start()},__appendItems:function(n){var t=this,i=t.owner;n=e.makeArray(n),i.append(n)},__bindMethods:function(){var e=this,n=e.owner,t={min:0,max:0};n.on("afterSort",function(e){t=e.autoResponsive.curMinMaxColHeight}),n.getMaxColHeight=function(){return t.max},n.getMinColHeight=function(){return t.min}},start:function(){this.resume()},stop:function(){this.pause()},pause:function(){this.__destroyed||(a.detach("scroll",this.__onScroll),this.__onScroll.stop())},resume:function(){var e=this;e.__destroyed||(a.on("scroll",e.__onScroll),e.__started=1)},destroy:function(){this.__destroyed=1}}),n},{requires:["dom","event"]});