/*! autoResponsive - v1.1 - 2013-07-08 2:36:58 PM
* Copyright (c) 2013 xudafeng; Licensed  */
KISSY.add("gallery/autoResponsive/1.1/plugin/loader",function(t){"use strict";function e(e){var i=this;e={load:"function"==typeof e.load?e.load:function(){t.log("AutoResponsive.Loader::constructor: the load function in user's config is undefined!","warn")},diff:e.diff||0,mod:"manual"==e.mod?"manual":"auto",qpt:15},i.config=e}function i(e,i,n,r){var o,s={},a=[],u=n.config,l=u.qpt||15;return s.start=function(){a=a.concat(t.makeArray(e));var u=function(){for(var t=+new Date;a.length>0&&50>new Date-t;){var c=a.splice(0,l);i.call(n,c)}return a.length>0?(o=setTimeout(u,25),void 0):(r&&r.call(n,e),s.stop(),s=null,void 0)};u()},s.stop=function(){o&&(clearTimeout(o),a=[])},s}var n=t.DOM,r=t.all,o=window,s=r(o),a=50;return t.augment(e,t.EventTarget,{init:function(e){var i=this,n=i.config,r=n.mod;i.owner=e,i.__bindMethods(),i.__started=i.__destroyed=i.__stopped=0,"manual"===r||(i.__onScroll=t.buffer(i.__doScroll,a,i),i.__onScroll(),i.start())},__doScroll:function(){var e=this,i=e.owner,r=e.config;if("up"!==e.__scrollDirection&&(t.log("AutoResponsive.Loader::__doScroll..."),!e.__loading)){if(i.isAdjusting())return e.__onScroll(),void 0;var o=t.get(i.get("container"));if(o.offsetWidth){var a=n.offset(o).top,u=r.diff,l=i.getMinColHeight(),c=s.scrollTop(),f=s.height();u+c+f>=a+l&&e.load()}}},load:function(){function e(t,e){n.__addItems(t,function(){e&&e.call(n),n.__doScroll()}),n.__loading=0}function i(){n.stop()}var n=this,r=n.config,o=r.load;return n.__stopped?(t.log("AutoResponsive.Loader::load: this loader has stopped, please to resume!","warn"),void 0):(t.log("AutoResponsive.Loader::loading..."),n.__loading=1,o&&o(e,i),void 0)},isLoading:function(){return this.__loading},isStarted:function(){return this.__started},isStopped:function(){return this.__stopped},isDestroyed:function(){return this.__destroyed},__addItems:function(t,e){var n=this;i(t,n.__appendItems,n,function(){e&&e.call(n),n.fire("autoresponsive.loader.complete",{items:t})}).start()},__appendItems:function(e){var i=this,n=i.owner;e=t.makeArray(e),n.append(e)},__bindMethods:function(){var t=this,e=t.owner,i={min:0,max:0};e.on("afterSort",function(t){i=t.autoResponsive.curMinMaxColHeight}),e.getMaxColHeight=function(){return i.max},e.getMinColHeight=function(){return i.min}},start:function(){var t=this;s.on("mousewheel",function(e){t.__scrollDirection=e.deltaY>0?"up":"down"}),this.resume()},stop:function(){this.pause(),this.__stopped=1},pause:function(){this.__destroyed||s.detach("scroll",this.__onScroll)},resume:function(){var t=this;t.__destroyed||(s.on("scroll",t.__onScroll),t.__started=1,t.__stopped=0)},destroy:function(){this.__destroyed=1}}),e},{requires:["dom","event"]});