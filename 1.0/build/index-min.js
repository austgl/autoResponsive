/*! autoResponsive - v1.0 - 2013-07-03 8:39:52 PM
* Copyright (c) 2013 xudafeng; Licensed  */
KISSY.add("gallery/autoResponsive/1.0/config",function(){"use strict";function e(){return{container:{value:t},selector:{value:t},filter:{value:t},fixedSelector:{value:t},priority:{value:t},colWidth:{value:10},colMargin:{value:{x:0,y:0}},animate:{value:!0},duration:{value:1},easing:{value:"easeNone"},direction:{value:"left"},random:{value:!1},sort:{value:t},layout:{value:t},autoHeight:{value:!0},resize:{value:!0},init:{value:!0},plugin:{value:[]},async:{value:!1},cache:!1,resizeFrequency:200}}var t="";return e}),KISSY.add("gallery/autoResponsive/1.0/anim",function(e){"use strict";function t(t){var n=this;e.mix(n,t),n.notSupport=11>e.UA.ie||"right"==n.direction,n._init()}var n=e.DOM,i=e.Anim,r=" ";return e.augment(t,{_init:function(){var e=this;return e.animate?(e.notSupport?e.fixedAnim():e.css3Anim(),void 0):(e.noneAnim(),void 0)},cssPrefixes:function(t,n){var i={};return e.each("-webkit- -moz- -o- -ms-  ".split(r),function(e){i[e+t]=n}),i},css3Anim:function(){var t=this;n.css(t.elm,e.merge(t.cssPrefixes("transform","translate("+t.x+"px,"+t.y+"px) "),t.cssPrefixes("transition-duration",t.duration+"s"))),t.caller.fire("afterElemSort",{autoResponsive:{elm:t.elm,position:{x:t.x,y:t.y},frame:t._self.frame}})},fixedAnim:function(){var e=this,t={top:e.y},n="left";"right"==e.direction&&(n="right"),t[n]=e.x,new i(e.elm,t,e.duration,e.easing,function(){e._self.fire("afterElemSort",{autoResponsive:{elm:e.elm,position:{x:e.x,y:e.y},frame:e._self.frame}})}).run()},noneAnim:function(){var e=this;n.css(e.elm,{left:e.x,top:e.y}),e._self.fire("afterElemSort",{autoResponsive:{elm:e.elm,position:{x:e.x,y:e.y},frame:e._self.frame}})}}),t},{requires:["dom","anim"]}),KISSY.add("gallery/autoResponsive/1.0/linkedlist",function(e){"use strict";function t(e){var t=this;t.length=0,t.head=null,t.tail=null,t.type=e.type||!0,t.query=[],t.init()}return e.augment(t,{init:function(){e.augment(Array,{shuffle:function(){for(var e,t,n=this.length;n;e=parseInt(Math.random()*n),t=this[--n],this[n]=this[e],this[e]=t);return this}})},add:function(e){var t=this;if(t.type)return t.query.push(e),void 0;var n={value:e,next:null,prev:null};0==t.length?t.head=t.tail=n:(t.tail.next=n,n.prev=t.tail,t.tail=n),t.length++},remove:function(e){var t=this;if(e>t.length-1||0>e)return null;var n=t.head,i=0;if(0==e)t.head=n.next,null==t.head?t.tail=null:t.head.previous=null;else if(e==t.length-1)n=t.tail,t.tail=n.prev,t.tail.next=null;else{for(;e>i++;)n=n.next;n.prev.next=n.next,n.next.prev=n.prev}t.length--},get:function(e){var t=this;return t.type?t.query[e]:t.node(e).value},node:function(e){var t=this;if(e>t.length-1||0>e)return null;for(var n=t.head,i=0;e>i++;)n=n.next;return n},update:function(e,t){var n=this;return n.type?(n.query[e]=t,void 0):(n.node(e).value=t,void 0)}}),t}),KISSY.add("gallery/autoResponsive/1.0/gridsort",function(e,t,n){"use strict";function i(t,n){var i=this;e.mix(i,e.merge(t,{_self:n})),i._init()}var r=e.DOM,a="";return e.augment(i,{_init:function(){var t=this,n=e.query(t.selector,t.container);switch(t.layout){case a:case"grid":default:t._gridSort(n);break;case"cell":t._cellSort(n)}},_filter:function(e){var t=this;if(t.filter!=a)return r.show(e),r.hasClass(e,t.filter)?(r.hide(e),!0):void 0},coordinate:function(e,t){return this._autoFit(e,r.outerWidth(t),r.outerHeight(t))},callAnim:function(e,n){var i=this;new t({elm:e,x:n[0],y:n[1],animate:i.animate,duration:i.duration,easing:i.easing,direction:i.direction,frame:i._self.frame,_self:i._self})},_cache:function(e){var t=this,n=!1;return t.priority==a?n:(t.cacheQuery||(t.cacheQuery=[]),r.hasClass(e,t.priority)||(n=!0,t.cacheQuery.push(e)),n)},clearCache:function(e,t){var n=this;n.cacheQuery&&(n.cacheQuery=[]),n._self.curQuery=e,n._self.itemLength=t.length},asyncize:function(e){var t=this;t._self.get("async")?setTimeout(function(){e.call(t)},0):e.call(t)},_gridSort:function(t){var n=this,i=0,a=n._getCols();n.doneQuery=[],n._setFrame(),n.random&&(t=t.shuffle()),n._self.fire("beforeSort",{autoResponsive:{elms:t}}),e.each(t,function(e,t){if(!(n.cache&&n._self.itemLength>t||n._filter(e)||n._cache(e))){n._self.fire("beforeElemSort",{autoResponsive:{elm:e,frame:n._self.frame}});var o=n.coordinate(a,e),s=o[1]+r.outerHeight(e);s>i&&(i=s),n.asyncize(function(){n.callAnim(e,o)})}}),e.each(n.cacheQuery,function(e){n._self.fire("beforeElemSort",{autoResponsive:{elm:e,frame:n._self.frame}});var t=n.coordinate(a,e),o=t[1]+r.outerHeight(e);o>i&&(i=o),n.asyncize(function(){n.callAnim(e,t)})}),n.clearCache(a,t),n._self.fire("afterSort",{autoResponsive:{elms:t,curColHeights:n._getCurColHeights(),frame:n._self.frame}}),n.setHeight(i)},_getCurColHeights:function(){var e=this;return e.doneQuery},_setFrame:function(){var e=this;e._self.frame++},_cellSort:function(t){var n=this,i=[];e.each(t,function(){e.log("star from here!"),i.push(n._getCells())})},_getCells:function(){return this._getCols()},_getCols:function(){var e=this;if(e._self.curQuery&&e.cache)return e._self.curQuery;for(var t=new n({}),i=0;Math.ceil(r.outerWidth(e.container)/e.colWidth)>i;i++)t.add(0);return t},_getCur:function(t,n){var i=[null,1/0],r=n.query.length?n.query:n;return e.each(r,function(e,a){var o=[];if(!(a+t>=r.length)){for(var s=a;a+t>s;s++)o.push(n.get(s));var u=Math.max.apply(Math,o);i[1]>u&&(i=[a,u])}}),i},_autoFit:function(e,t,n){for(var i=this,r=Math.ceil((t+i.colMargin.x)/i.colWidth),a=i._getCur(r,e),o=a[0];r+a[0]>o;o++)e.update(o,a[1]+n+i.colMargin.y);return i.doneQuery.push(a[1]+n+i.colMargin.y),[a[0]*i.colWidth+i.colMargin.x,a[1]+i.colMargin.y]},setHeight:function(e){var t=this;t.autoHeight&&r.height(t.container,e+t.colMargin.y)}}),i},{requires:["./anim","./linkedlist","dom"]}),KISSY.add("gallery/autoResponsive/1.0/base",function(e,t,n,i){"use strict";function r(){var t=this;return r.superclass.constructor.apply(t,arguments),e.get(t.get("container"))?(t.fire("beforeInit",{autoResponsive:t}),t.get("init")&&t.init(),t.fire("afterInit",{autoResponsive:t}),void 0):(e.log("can not init, lack of container!"),void 0)}var a=e.DOM,o=e.Event,s=window;return e.extend(r,i,{init:function(){var t=this;t._bindEvent(),t.initPlugin(),t.render(),e.log("init!")},initPlugin:function(){var t=this;t.api={},e.each(t.get("plugin"),function(n){n.init(t),e.mix(t.api,n.api)})},render:function(){var t=this,i=t.getAttrVals();t.frame=t.frame||0,arguments[0]&&e.each(arguments[0],function(e,t){i[t]=e}),e.mix(i,t.api),new n(i,t)},_bind:function(e){var t=this;t.get("resize")&&o.on(s,"resize",function(){e.call(t)})},_bindEvent:function(){var t=this;t._bind(e.throttle(function(){t.render(),t.fire("resize")},t.get("resizeFrequency"),t))},adjust:function(){var e=this;e.__isAdjusting=1,e.render(),e.__isAdjusting=0},isAdjusting:function(){return this.__isAdjusting||0},priority:function(e){var t=this;t.render({priority:e})},filter:function(e){var t=this;t.render({filter:e})},margin:function(e){var t=this;t.render({colMargin:e})},direction:function(e){var t=this;t.render({direction:e})},random:function(){var e=this;e.render({random:!0})},option:function(e){var t=this;t.render(e)},append:function(e){var t=this;a.append(e,t.get("container")),t.render({cache:!0})},prepend:function(e){var t=this;a.prepend(e,t.get("container")),t.render()}},{ATTRS:new t}),r},{requires:["./config","./gridsort","base","dom","event"]}),KISSY.add("gallery/autoResponsive/1.0/plugin/hash",function(e){"use strict";function t(e){var t=this;t.prefix=e.prefix||"ks-",t.api={}}var n=(e.Event,"&"),i="=";return e.augment(t,{init:function(){var t=this;e.log("hash init!"),t.hasHash()&&t.parse()},hasHash:function(){return location.hash?!0:!1},parse:function(){var e=this;e.getParam()},getParam:function(){var t=this;t.hash=location.hash.split(n),e.each(t.hash,function(e){t.getPriority(e),t.getFilter(e)})},getPriority:function(t){var n=this,r=n.prefix+"priority";-1!=t.indexOf(r)&&e.mix(n.api,{priority:t.split(i)[1]})},getFilter:function(t){var n=this,r=n.prefix+"filter";-1!=t.indexOf(r)&&e.mix(n.api,{filter:t.split(i)[1]})}}),t},{requires:["event"]}),KISSY.add("gallery/autoResponsive/1.0/plugin/drag",function(e){"use strict";function t(){}var n=(e.Event,e.DD),i=n.DraggableDelegate,r=n.Droppable;return e.augment(t,{init:function(){e.log("drag init!")},_bindDrop:function(e){var t=this;"on"==t.drag&&new r({node:e}).on("dropenter",function(e){D.insertAfter(e.drag.get("node"),e.drop.get("node")),t._self.render()})},_bindBrag:function(){var e=this;"on"==e.drag&&new i({container:e.container,selector:e.selector,move:!0}).on("dragstart",function(e){var t=e.drag.get("node")[0];this.p={left:t.offsetLeft,top:t.offsetTop}}).on("drag",function(){}).on("dragend",function(e){D.css(e.drag.get("node"),this.p)})}}),t},{requires:["event","dd"]}),KISSY.add("autoResponsive/1.0/plugin/loader",function(e){"use strict";function t(t){var n=this;t={load:"function"==typeof t.load?t.load:function(){e.log("AutoResponsive.Loader::constructor: the load function in user's config is undefined!","warn")},diff:t.diff||0,mod:"manual"==t.mod?"manual":"auto"},n.config=t}function n(t,n,i,r){var a,o,s={};return s.start=function(){o=[].concat(e.makeArray(t)),o.length>0?function(){var e=+new Date;do{var s=o.shift();n.call(i,s)}while(o.length>0&&50>new Date-e);o.length>0?a=setTimeout(arguments.callee,25):r&&r.call(i,t)}():r&&r.call(i,t)},s.stop=function(){a&&(clearTimeout(a),o=[])},s}var i=e.all,r=window,a=i(r),o=50;return e.augment(t,e.EventTarget,{init:function(t){var n=this,i=n.config,r=i.mod;n._self=t,n.__bindMethods(),"manual"===r||(n.__onScroll=e.buffer(n.__doScroll,o,n),n.__onScroll(),n.start())},__doScroll:function(){var t=this,n=t._self,i=t.config;if(e.log("AutoResponsive.Loader::__doScroll..."),!t.__loading){if(n.isAdjusting())return t.__onScroll(),void 0;var r=e.get(n.get("container"));if(r.offsetWidth){var o=r.offset().top,s=i.diff,u=n.getMinColHeight();s+a.scrollTop()+a.height()>=o+u&&t.load()}}},load:function(){function t(e,t){i.__loading=0,i.__addItems(e,function(){t&&t.apply(this,arguments),i.__doScroll()})}function n(){i.stop()}var i=this,r=i.config,a=r.load;e.log("AutoResponsive.Loader::loading..."),i.__loading=1,a&&a(t,n)},__addItems:function(e,t){var i=this,r=i._self;return i._adder=n(e,__appendItems,i,function(){r.adjust(),i._adder=0,t&&t.call(i),i.fire("autoresponsive.loader.complete",{items:e})}),i._adder.start(),i._adder},__appendItems:function(t){var n=this,i=n._self;t=e.makeArray(t),i.append(t)},__bindMethods:function(){var e=this,t=e._self,n=[0];t.on("afterSort",function(e){n=e.autoResponsive.curColHeights}),t.getMaxColHeight=function(){return Math.max.apply(Math,n)},t.getMinColHeight=function(){return Math.min.apply(Math,n)}},start:function(){this.resume()},stop:function(){this.pause()},pause:function(){this.__destroyed||(a.detach("scroll",this.__onScroll),this.__onScroll.stop())},resume:function(){var e=this;e.__destroyed||(a.on("scroll",e.__onScroll),e.__started=1)},destroy:function(){this.__destroyed=1}}),t},{requires:["event"]}),KISSY.add("gallery/autoResponsive/1.0/index",function(e,t,n,i,r){return t.Hash=n,t.Drag=i,t.Loader=r,t},{requires:["./base","./plugin/hash","./plugin/drag","./plugin/loader"]});