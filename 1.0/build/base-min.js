/*! autoResponsive - v1.0 - 2013-07-02 2:38:32 PM
* Copyright (c) 2013 xudafeng; Licensed  */
KISSY.add("gallery/autoResponsive/1.0/config",function(){"use strict";function e(){return{container:{value:t},selector:{value:t},filter:{value:t},fixedSelector:{value:t},priority:{value:t},colWidth:{value:10},colMargin:{value:{x:0,y:0}},animate:{value:!0},duration:{value:1},easing:{value:"easeNone"},direction:{value:"left"},random:{value:!1},sort:{value:t},layout:{value:t},autoHeight:{value:!0},resize:{value:!0},init:{value:!0},plugin:{value:[]},async:{value:!1},cache:!1,resizeFrequency:200}}var t="";return e}),KISSY.add("gallery/autoResponsive/1.0/anim",function(e){"use strict";function t(t){var i=this;e.mix(i,t),i._init()}var i=e.DOM,n=e.Anim,r=" ",a=11>e.UA.ie||"right"==self.direction;return e.augment(t,{_init:function(){var e=this;return e.animate?(a?e.fixedAnim():e.css3Anim(),void 0):(e.noneAnim(),void 0)},cssPrefixes:function(t,i){var n={};return e.each("-webkit- -moz- -o- -ms-  ".split(r),function(e){n[e+t]=i}),n},css3Anim:function(){var t=this;i.css(t.elm,e.merge(t.cssPrefixes("transform","translate("+t.x+"px,"+t.y+"px) "),t.cssPrefixes("transition-duration",t.duration+"s"))),t._self.fire("afterElemSort",{autoResponsive:{elm:t.elm,position:{x:t.x,y:t.y},frame:t._self.frame}})},fixedAnim:function(){var e=this,t={top:e.y},i="left";"right"==e.direction&&(i="right"),t[i]=e.x,new n(e.elm,t,e.duration,e.easing,function(){e._self.fire("afterElemSort",{autoResponsive:{elm:e.elm,position:{x:e.x,y:e.y},frame:e._self.frame}})}).run()},noneAnim:function(){var e=this;i.css(e.elm,{left:e.x,top:e.y}),e._self.fire("afterElemSort",{autoResponsive:{elm:e.elm,position:{x:e.x,y:e.y},frame:e._self.frame}})}}),t},{requires:["dom","anim"]}),KISSY.add("gallery/autoResponsive/1.0/linkedlist",function(e){"use strict";function t(e){var t=this;t.length=0,t.head=null,t.tail=null,t.type=e.type||!0,t.query=[],t.init()}return e.augment(t,{init:function(){e.augment(Array,{shuffle:function(){for(var e,t,i=this.length;i;e=parseInt(Math.random()*i),t=this[--i],this[i]=this[e],this[e]=t);return this}})},add:function(e){var t=this;if(t.type)return t.query.push(e),void 0;var i={value:e,next:null,prev:null};0==t.length?t.head=t.tail=i:(t.tail.next=i,i.prev=t.tail,t.tail=i),t.length++},remove:function(e){var t=this;if(e>t.length-1||0>e)return null;var i=t.head,n=0;if(0==e)t.head=i.next,null==t.head?t.tail=null:t.head.previous=null;else if(e==t.length-1)i=t.tail,t.tail=i.prev,t.tail.next=null;else{for(;e>n++;)i=i.next;i.prev.next=i.next,i.next.prev=i.prev}t.length--},get:function(e){var t=this;return t.type?t.query[e]:t.node(e).value},node:function(e){var t=this;if(e>t.length-1||0>e)return null;for(var i=t.head,n=0;e>n++;)i=i.next;return i},update:function(e,t){var i=this;return i.type?(i.query[e]=t,void 0):(i.node(e).value=t,void 0)}}),t}),KISSY.add("gallery/autoResponsive/1.0/gridsort",function(e,t,i){"use strict";function n(t,i){var n=this;e.mix(n,e.merge(t,{_self:i})),n._init()}var r=e.DOM,a="";return e.augment(n,{_init:function(){var t=this,i=e.query(t.selector,t.container);switch(t.layout){case a:case"grid":default:t._gridSort(i);break;case"cell":t._cellSort(i)}},_filter:function(e){var t=this;if(t.filter!=a)return r.show(e),r.hasClass(e,t.filter)?(r.hide(e),!0):void 0},coordinate:function(e,t){return this._autoFit(e,r.outerWidth(t),r.outerHeight(t))},callAnim:function(e,i){var n=this;new t({elm:e,x:i[0],y:i[1],animate:n.animate,duration:n.duration,easing:n.easing,direction:n.direction,frame:n._self.frame,_self:n._self})},_cache:function(e){var t=this,i=!1;return t.priority==a?i:(t.cacheQuery||(t.cacheQuery=[]),r.hasClass(e,t.priority)||(i=!0,t.cacheQuery.push(e)),i)},clearCache:function(e,t){var i=this;i.cacheQuery&&(i.cacheQuery=[]),i._self.curQuery=e,i._self.itemLength=t.length},asyncize:function(e){var t=this;t._self.get("async")?setTimeout(function(){e.call(t)},0):e.call(t)},_gridSort:function(t){var i=this,n=0,a=i._getCols();i._setFrame(),i.random&&(t=t.shuffle()),i._self.fire("beforeSort",{autoResponsive:{elms:t}}),e.each(t,function(e,t){if(!(i.cache&&i._self.itemLength>t||i._filter(e)||i._cache(e))){i._self.fire("beforeElemSort",{autoResponsive:{elm:e,frame:i._self.frame}});var o=i.coordinate(a,e);o[1]+r.outerHeight(e)>n&&(n=o[1]+r.outerHeight(e)),i.asyncize(function(){i.callAnim(e,o)})}}),e.each(i.cacheQuery,function(e){i._self.fire("beforeElemSort",{autoResponsive:{elm:e,frame:i._self.frame}});var t=i.coordinate(a,e);t[1]+r.outerHeight(e)>n&&(n=t[1]+r.outerHeight(e)),i.asyncize(function(){i.callAnim(e,t)})}),i.clearCache(a,t),i._self.fire("afterSort",{autoResponsive:{elms:t}}),i.setHeight(n)},_setFrame:function(){var e=this;e._self.frame++},_cellSort:function(t){var i=this,n=[];e.each(t,function(){e.log("star from here!"),n.push(i._getCells())})},_getCells:function(){return this._getCols()},_getCols:function(){var e=this;if(e._self.curQuery&&e.cache)return e._self.curQuery;for(var t=new i({}),n=0;Math.ceil(r.outerWidth(e.container)/e.colWidth)>n;n++)t.add(0);return t},_getCur:function(t,i){var n=[null,1/0],r=i.query.length?i.query:i;return e.each(r,function(e,a){var o=[];if(!(a+t>=r.length)){for(var u=a;a+t>u;u++)o.push(i.get(u));n[1]>Math.max.apply(Math,o)&&(n=[a,Math.max.apply(Math,o)])}}),n},_autoFit:function(e,t,i){for(var n=this,r=Math.ceil((t+n.colMargin.x)/n.colWidth),a=n._getCur(r,e),o=a[0];r+a[0]>o;o++)e.update(o,a[1]+i+n.colMargin.y);return[a[0]*n.colWidth+n.colMargin.x,a[1]+n.colMargin.y]},setHeight:function(e){var t=this;t.autoHeight&&r.height(t.container,e+t.colMargin.y)}}),n},{requires:["./anim","./linkedlist","dom"]}),KISSY.add("gallery/autoResponsive/1.0/base",function(e,t,i,n){"use strict";function r(){var t=this;return r.superclass.constructor.apply(t,arguments),e.get(t.get("container"))?(t.fire("beforeInit",{autoResponsive:t}),t.get("init")&&t.init(),t.fire("afterInit",{autoResponsive:t}),void 0):(e.log("can not init,lack container!"),void 0)}var a=e.DOM,o=e.Event,u=window;return e.extend(r,n,{init:function(){var t=this;t._bindEvent(),t.initPlugin(),t.render(),e.log("init!")},initPlugin:function(){var t=this;t.api={},e.each(t.get("plugin"),function(i){i.init(t),e.mix(t.api,i.api)})},render:function(){var t=this,n=t.getAttrVals();arguments[0]&&e.each(arguments[0],function(e,t){n[t]=e}),e.mix(n,t.api),new i(n,t)},_bind:function(e){var t=this;t.get("resize")&&o.on(u,"resize",function(){e.call(t)})},_bindEvent:function(){var t=this;t._bind(e.throttle(function(){t.render(),t.fire("resize")},t.get("resizeFrequency"),t))},adjust:function(){var e=this;e.render()},priority:function(e){var t=this;t.render({priority:e})},filter:function(e){var t=this;t.render({filter:e})},margin:function(e){var t=this;t.render({colMargin:e})},direction:function(e){var t=this;t.render({direction:e})},random:function(){var e=this;e.render({random:!0})},option:function(e){var t=this;t.render(e)},append:function(e){var t=this;a.append(e,t.get("container")),t.render({cache:!0})},prepend:function(e){var t=this;a.prepend(e,t.get("container")),t.render()}},{ATTRS:new t}),r},{requires:["./config","./gridsort","base","dom","event"]});