/*! autoResponsive - v1.0 - 2013-07-06 4:01:45 PM
* Copyright (c) 2013 xudafeng; Licensed  */
KISSY.add("gallery/autoResponsive/1.0/plugin/loader",function(e){"use strict";function n(n){var t=this;n={load:"function"==typeof n.load?n.load:function(){e.log("AutoResponsive.Loader::constructor: the load function in user's config is undefined!","warn")},diff:n.diff||0,mod:"manual"==n.mod?"manual":"auto",qpt:15},t.config=n}function t(n,t,i,r){var o,a={},u=[],s=i.config,c=s.qpt||15;return a.start=function(){u=u.concat(e.makeArray(n));var s=function(){for(var e=+new Date;u.length>0&&50>new Date-e;){var l=u.splice(0,c);t.call(i,l)}return u.length>0?(o=setTimeout(s,25),void 0):(r&&r.call(i,n),a.stop(),a=null,void 0)};s()},a.stop=function(){o&&(clearTimeout(o),u=[])},a}var i=e.DOM,r=e.all,o=window,a=r(o),u=50;return e.augment(n,e.EventTarget,{init:function(n){var t=this,i=t.config,r=i.mod;t.owner=n,t.__bindMethods(),"manual"===r||(t.__onScroll=e.buffer(t.__doScroll,u,t),t.__onScroll(),t.start())},__doScroll:function(){var n=this,t=n.owner,r=n.config;if(e.log("AutoResponsive.Loader::__doScroll..."),!n.__loading){if(t.isAdjusting())return n.__onScroll(),void 0;var o=e.get(t.get("container"));if(o.offsetWidth){var u=i.offset(o).top,s=r.diff,c=t.getMinColHeight(),l=a.scrollTop(),f=a.height();s+l+f>=u+c&&n.load()}}},load:function(){function n(e,n){i.__loading=0,i.__addItems(e,function(){n&&n.call(i),i.__doScroll()})}function t(){i.stop()}var i=this,r=i.config,o=r.load;e.log("AutoResponsive.Loader::loading..."),i.__loading=1,o&&o(n,t)},__addItems:function(e,n){var i=this;t(e,i.__appendItems,i,function(){n&&n.call(i),i.fire("autoresponsive.loader.complete",{items:e})}).start()},__appendItems:function(n){var t=this,i=t.owner;n=e.makeArray(n),i.append(n)},__bindMethods:function(){var e=this,n=e.owner,t={min:0,max:0};n.on("afterSort",function(e){t=e.autoResponsive.curMinMaxColHeight}),n.getMaxColHeight=function(){return t.max},n.getMinColHeight=function(){return t.min}},start:function(){this.resume()},stop:function(){this.pause()},pause:function(){this.__destroyed||(a.detach("scroll",this.__onScroll),this.__onScroll.stop())},resume:function(){var e=this;e.__destroyed||(a.on("scroll",e.__onScroll),e.__started=1)},destroy:function(){this.__destroyed=1}}),n},{requires:["dom","event"]});