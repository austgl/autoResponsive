/*! autoResponsive - v1.0 - 2013-07-03 8:39:52 PM
* Copyright (c) 2013 xudafeng; Licensed  */
KISSY.add("autoResponsive/1.0/plugin/loader",function(e){"use strict";function t(t){var n=this;t={load:"function"==typeof t.load?t.load:function(){e.log("AutoResponsive.Loader::constructor: the load function in user's config is undefined!","warn")},diff:t.diff||0,mod:"manual"==t.mod?"manual":"auto"},n.config=t}function n(t,n,i,r){var a,o,s={};return s.start=function(){o=[].concat(e.makeArray(t)),o.length>0?function(){var e=+new Date;do{var s=o.shift();n.call(i,s)}while(o.length>0&&50>new Date-e);o.length>0?a=setTimeout(arguments.callee,25):r&&r.call(i,t)}():r&&r.call(i,t)},s.stop=function(){a&&(clearTimeout(a),o=[])},s}var i=e.all,r=window,a=i(r),o=50;return e.augment(t,e.EventTarget,{init:function(t){var n=this,i=n.config,r=i.mod;n._self=t,n.__bindMethods(),"manual"===r||(n.__onScroll=e.buffer(n.__doScroll,o,n),n.__onScroll(),n.start())},__doScroll:function(){var t=this,n=t._self,i=t.config;if(e.log("AutoResponsive.Loader::__doScroll..."),!t.__loading){if(n.isAdjusting())return t.__onScroll(),void 0;var r=e.get(n.get("container"));if(r.offsetWidth){var o=r.offset().top,s=i.diff,u=n.getMinColHeight();s+a.scrollTop()+a.height()>=o+u&&t.load()}}},load:function(){function t(e,t){i.__loading=0,i.__addItems(e,function(){t&&t.apply(this,arguments),i.__doScroll()})}function n(){i.stop()}var i=this,r=i.config,a=r.load;e.log("AutoResponsive.Loader::loading..."),i.__loading=1,a&&a(t,n)},__addItems:function(e,t){var i=this,r=i._self;return i._adder=n(e,__appendItems,i,function(){r.adjust(),i._adder=0,t&&t.call(i),i.fire("autoresponsive.loader.complete",{items:e})}),i._adder.start(),i._adder},__appendItems:function(t){var n=this,i=n._self;t=e.makeArray(t),i.append(t)},__bindMethods:function(){var e=this,t=e._self,n=[0];t.on("afterSort",function(e){n=e.autoResponsive.curColHeights}),t.getMaxColHeight=function(){return Math.max.apply(Math,n)},t.getMinColHeight=function(){return Math.min.apply(Math,n)}},start:function(){this.resume()},stop:function(){this.pause()},pause:function(){this.__destroyed||(a.detach("scroll",this.__onScroll),this.__onScroll.stop())},resume:function(){var e=this;e.__destroyed||(a.on("scroll",e.__onScroll),e.__started=1)},destroy:function(){this.__destroyed=1}}),t},{requires:["event"]});