/*! autoResponsive - v1.0 - 2013-07-05 1:33:32 PM
* Copyright (c) 2013 xudafeng; Licensed  */
KISSY.add("autoResponsive/1.0/plugin/loader",function(e){"use strict";function t(t){var n=this;t={load:"function"==typeof t.load?t.load:function(){e.log("AutoResponsive.Loader::constructor: the load function in user's config is undefined!","warn")},diff:t.diff||0,mod:"manual"==t.mod?"manual":"auto",qpt:15},n.config=t}function n(t,n,i,r){var a,o={},s=[],u=i.config,l=u.qpt||15;return o.start=function(){s=s.concat(e.makeArray(t));var u=function(){for(var e=+new Date;s.length>0&&50>new Date-e;){var c=s.splice(0,l);n.call(i,c)}return s.length>0?(a=setTimeout(u,25),void 0):(r&&r.call(i,t),o.stop(),o=null,void 0)};u()},o.stop=function(){a&&(clearTimeout(a),s=[])},o}var i=e.DOM,r=e.all,a=window,o=r(a),s=50;return e.augment(t,e.EventTarget,{init:function(t){var n=this,i=n.config,r=i.mod;n._self=t,n.__bindMethods(),"manual"===r||(n.__onScroll=e.buffer(n.__doScroll,s,n),n.__onScroll(),n.start())},__doScroll:function(){var t=this,n=t._self,r=t.config;if(e.log("AutoResponsive.Loader::__doScroll..."),!t.__loading){if(n.isAdjusting())return t.__onScroll(),void 0;var a=e.get(n.get("container"));if(a.offsetWidth){var s=i.offset(a).top,u=r.diff,l=n.getMinColHeight(),c=o.scrollTop(),f=o.height();u+c+f>=s+l&&t.load()}}},load:function(){function t(e,t){i.__loading=0,i.__addItems(e,function(){t&&t.call(i),i.__doScroll()})}function n(){i.stop()}var i=this,r=i.config,a=r.load;e.log("AutoResponsive.Loader::loading..."),i.__loading=1,a&&a(t,n)},__addItems:function(e,t){var i=this;n(e,i.__appendItems,i,function(){t&&t.call(i),i.fire("autoresponsive.loader.complete",{items:e})}).start()},__appendItems:function(t){var n=this,i=n._self;t=e.makeArray(t),i.append(t)},__bindMethods:function(){var e=this,t=e._self,n={min:0,max:0};t.on("afterSort",function(e){n=e.autoResponsive.curMinMaxColHeight}),t.getMaxColHeight=function(){return n.max},t.getMinColHeight=function(){return n.min}},start:function(){this.resume()},stop:function(){this.pause()},pause:function(){this.__destroyed||(o.detach("scroll",this.__onScroll),this.__onScroll.stop())},resume:function(){var e=this;e.__destroyed||(o.on("scroll",e.__onScroll),e.__started=1)},destroy:function(){this.__destroyed=1}}),t},{requires:["dom","event"]});